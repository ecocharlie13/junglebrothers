window.Gantt = class {
  constructor(selector, tasks) {
    const container = document.querySelector(selector);
    container.innerHTML = "";

    if (!tasks.length) return;

    const parse = (d) => new Date(d);
    const minDate = new Date(Math.min(...tasks.map(t => parse(t.start))));
    const maxDate = new Date(Math.max(...tasks.map(t => parse(t.end))));
    const totalDays = Math.ceil((maxDate - minDate) / (1000 * 60 * 60 * 24)) + 1;

    // Grade base
    const grid = document.createElement("div");
    grid.className = "relative w-full border-t border-gray-300 h-auto";

    tasks.forEach(task => {
      const start = new Date(task.start);
      const end = new Date(task.end);
      const offset = Math.floor((start - minDate) / (1000 * 60 * 60 * 24));
      const duration = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) || 1;

      const bar = document.createElement("div");
      bar.className = "absolute bg-purple-400 text-white text-xs px-2 py-1 rounded shadow";
      bar.style.left = `${offset * 16}px`;
      bar.style.width = `${duration * 16}px`;
      bar.style.top = `${tasks.indexOf(task) * 32}px`;
      bar.textContent = task.name;

      grid.appendChild(bar);
    });

    grid.style.height = `${tasks.length * 32}px`;
    grid.style.minWidth = `${totalDays * 16}px`;

    container.appendChild(grid);
  }
};
