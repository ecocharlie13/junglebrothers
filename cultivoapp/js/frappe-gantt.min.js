window.Gantt = class {
  constructor(selector, tasks) {
    const container = document.querySelector(selector);
    container.innerHTML = "";

    const cores = ["bg-purple-300", "bg-green-300", "bg-blue-300", "bg-yellow-300", "bg-pink-300", "bg-red-300"];
    const cultivos = {};
    let corIndex = 0;

    const hoje = new Date().toISOString().split("T")[0];
    const hojeDiv = document.createElement("div");
    hojeDiv.className = "w-full text-center my-4 text-sm text-gray-500 font-medium";
    hojeDiv.textContent = `ðŸ“ Hoje: ${hoje}`;
    container.appendChild(hojeDiv);

    tasks.forEach(task => {
      const cultivoId = task.id.split("-")[0];
      if (!cultivos[cultivoId]) {
        cultivos[cultivoId] = cores[corIndex % cores.length];
        corIndex++;
      }

      const cor = cultivos[cultivoId];

      const ini = new Date(task.start);
      const fim = new Date(task.end);
      const duracao = Math.max(1, (fim - ini) / (1000 * 60 * 60 * 24)); // em dias

      const bar = document.createElement("div");
      bar.className = `${cor} my-2 px-4 py-2 rounded shadow text-sm inline-block`;
      bar.style.width = `${duracao * 10}px`;

      const nome = document.createElement("div");
      nome.className = "font-semibold text-gray-800 truncate";
      nome.textContent = task.name;

      const datas = document.createElement("div");
      datas.className = "text-gray-700 text-xs";
      datas.textContent = `ðŸ—“ ${task.start} â†’ ${task.end}`;

      bar.appendChild(nome);
      bar.appendChild(datas);
      container.appendChild(bar);
    });
  }
};
