window.Gantt = class {
  constructor(selector, tasks) {
    const container = document.querySelector(selector);
    container.innerHTML = "";

    const cores = ["#c084fc", "#4ade80", "#60a5fa", "#facc15", "#f472b6"];
    const grupos = {};

    tasks.forEach(t => {
      const grupo = t.id.split("-")[0];
      if (!grupos[grupo]) {
        grupos[grupo] = cores[Object.keys(grupos).length % cores.length];
      }
    });

    const hoje = new Date().toISOString().split("T")[0];
    const hojeLabel = document.createElement("div");
    hojeLabel.className = "text-sm text-gray-600 mb-2";
    hojeLabel.innerHTML = `<span class='text-red-600'>üìç Hoje:</span> ${hoje}`;
    container.appendChild(hojeLabel);

    tasks.forEach(task => {
      const bar = document.createElement("div");
      bar.className = "relative flex items-center gap-2 mb-2";

      const cor = grupos[task.id.split("-")[0]];
      const dias = (new Date(task.end) - new Date(task.start)) / (1000 * 60 * 60 * 24);
      const largura = Math.max(30, dias * 20); // largura m√≠nima e propor√ß√£o

      const dataInicio = document.createElement("span");
      dataInicio.className = "text-xs text-gray-500 w-12 text-right";
      dataInicio.textContent = formatar(task.start);

      const barra = document.createElement("div");
      barra.textContent = task.name;
      barra.style.width = largura + "px";
      barra.className = "text-xs text-white text-center py-1 rounded";
      barra.style.backgroundColor = cor;

      const dataFim = document.createElement("span");
      dataFim.className = "text-xs text-gray-500 w-12";
      dataFim.textContent = formatar(task.end);

      bar.appendChild(dataInicio);
      bar.appendChild(barra);
      bar.appendChild(dataFim);
      container.appendChild(bar);
    });

    function formatar(iso) {
      const meses = ["Jan", "Fev", "Mar", "Abr", "Mai", "Jun", "Jul", "Ago", "Set", "Out", "Nov", "Dez"];
      const d = new Date(iso);
      return `${d.getDate().toString().padStart(2, "0")} ${meses[d.getMonth()]}`;
    }
  }
};
